<html>
   <head>
      <title>Collisions</title>
   </head>
   <body style="color: #ffffff; background-color: #000000">
      <p id="p">
         <canvas id="gc" width="500" height="500"
          style="border: 1px solid white" onmousedown="clickBall(event)">
            Your browser does not support the HTML5
            <code>canvas</code> element.   
         </canvas>
         <br />
         Collisions: <label id="lblCollisions" style="color:#00ff00"></label>
      </p>
   </body>
   <script>
      var canvas;
      var context;
      var boundRect;
      var screen = {};
      var ballvec = [];
      var lblCollisions = getDOM('lblCollisions');
      var collisions = 0;
      var ballCount = 10;
      
      window.onload = function()
      {
         getDOM('p').style.textAlign = 'center';
         canvas = getDOM('gc');
         context = canvas.getContext('2d');
         boundRect = canvas.getBoundingClientRect();
         screen.fps = 60;
         screen.width = canvas.width;
         screen.height = canvas.height;
         
         for (i = 0; i < ballCount; i++)
         {
            var ball = {};
            initBall(ball);
            ballvec.push(ball);
         }
         
         setInterval(draw, 1000/screen.fps);
      }
      
      window.onresize = function()
      {
         boundRect = canvas.getBoundingClientRect();
         console.log(
            'canvas @ (' + boundRect.top + ', ' + boundRect.left + ')'
         );
      }
      
      function clickBall(event)
      {
         var x = event.clientX - boundRect.left;
         var y = event.clientY - boundRect.top;
         
         console.log('mouseclick @ (' + x + ', ' + y + ')');
         
         for (i = 0; i < ballvec.length; i++)
         {
            if (isInBall(ballvec[i], x, y))
            {
               ballvec[i].Dx = -(ballvec[i].Dx * 1.15);
               ballvec[i].Dy = -(ballvec[i].Dy * 1.15);
            }
         }
      }
      
      function getDOM(id)
      {
         return document.getElementById(id);
      }
      
      function draw()
      {
         context.fillStyle = '#000000';
         context.fillRect(0, 0, screen.width, screen.height);
         
         for (i = 0; i < ballvec.length; i++)
         {
            drawBall(ballvec[i]);
            moveBall(ballvec[i]);
            lblCollisions.innerHTML = collisions;
         }
      }
      
      function initBall(ball)
      {
         maxInitSpeed = 0.5;
         ball.W = 15;
         ball.H = 15;
         ball.X = randomize(0, screen.width - ball.W - 1);
         ball.Y = randomize(0, screen.height - ball.H - 1);
         ball.Dx = randomize(-maxInitSpeed, maxInitSpeed);
         ball.Dy = randomize(-maxInitSpeed, maxInitSpeed);
         ball.color = '#ffff00';
      }
      
      function drawBall(ball)
      {
         context.fillStyle = ball.color;
         context.fillRect(ball.X, ball.Y, ball.W, ball.H);
      }
      
      function moveBall(ball)
      {
         if (ball.X + ball.W + ball.Dx >= screen.width || ball.X <= 0)
         {
            ball.Dx = -ball.Dx;
            collisions++;
         }
         
         if (ball.Y + ball.H + ball.Dy >= screen.height || ball.Y <= 0)
         {
            ball.Dy = -ball.Dy;
            collisions++;
         }
         
         ball.X += ball.Dx;
         ball.Y += ball.Dy;
      }
      
      function isInBall(ball, x, y)
      {
         return (x >= ball.X && x <= ball.X + ball.W) &&
                (y >= ball.Y && y <= ball.Y + ball.H);
      }
      
      function randomize(minimum, maximum)
      {
         return Math.random() * (maximum - minimum) + minimum;
      }
   </script>
</html>
